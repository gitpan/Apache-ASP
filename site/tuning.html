

<html>
<head>
<title>Apache :: ASP :: TUNING [ apache + asp + perl = apache::asp ]</title>



</head>
<body bgcolor=black link=#003090 alink=#ff5599 vlink=#993399>

<table border=0 cellpadding=5 cellspacing=0 height=95% width=100%>
<tr bgcolor=#ff4488>
<td colspan=2>
	<table border=0 cellpadding=0 cellspacing=0 width=100%>
	<tr>
	<td><img border=0 src=apache_asp.gif alt="Apache :: ASP"></td>	
	
		<td align=right></td>
	
	</tr>
	</table>
</td>
</tr>

<tr>

<td valign=top bgcolor=#c0c0c0>
	<table border=0 cellpadding=0 cellspacing=2 width=100>
	<tr><td align=center colspan=2><hr size=1></td></tr>

	
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=index.html><font face=verdana size=-1 color=#003090><nobr>INTRO</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=install.html><font face=verdana size=-1 color=#003090><nobr>INSTALL</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=config.html><font face=verdana size=-1 color=#003090><nobr>CONFIG</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=syntax.html><font face=verdana size=-1 color=#003090><nobr>SYNTAX</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=events.html><font face=verdana size=-1 color=#003090><nobr>EVENTS</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=objects.html><font face=verdana size=-1 color=#003090><nobr>OBJECTS</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=ssi.html><font face=verdana size=-1 color=#003090><nobr>SSI</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=cgi.html><font face=verdana size=-1 color=#003090><nobr>CGI</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=perlscript.html><font face=verdana size=-1 color=#003090><nobr>PERLSCRIPT</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=cookies.html><font face=verdana size=-1 color=#003090><nobr>COOKIES</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=faq.html><font face=verdana size=-1 color=#003090><nobr>FAQ</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>-</b></font></td>
		<td><a href=tuning.html><font face=verdana size=-1 color=#003090><nobr>TUNING</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=kudos.html><font face=verdana size=-1 color=#003090><nobr>CREDITS</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=support.html><font face=verdana size=-1 color=#003090><nobr>SUPPORT</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=sites.html><font face=verdana size=-1 color=#003090><nobr>SITES USING</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=todo.html><font face=verdana size=-1 color=#003090><nobr>TODO</nobr></font></a></td>
		</tr>
		
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=changes.html><font face=verdana size=-1 color=#003090><nobr>CHANGES</nobr></font></a></td>
		</tr>
		<tr><td colspan=2><hr size=1></td></tr>
		<tr>
		<td><font size=2 face="courier new"><b>&nbsp;</b></font></td>
		<td><a href=eg/index.html><font face=verdana size=-1 color=#003090><nobr>EXAMPLES</nobr></font></a></td>
		</tr>
		
	<tr>
		<td align=center colspan=2>
		<hr size=1>
		<a href=http://perl.apache.org><img 
			src=powered_by_modperl.gif border=0
			alt="Powered by ModPerl & Apache"
			></a>
		<br>
		<a href=http://www.nodeworks.com/asp/><img 
			src=powered_by_apache_asp.jpg border=0
			alt="Powered by Apache::ASP"
			></a>
		<hr size=1>
		</td>
	</tr>
	</table>
</td>

<td valign=top bgcolor=white>
	<font size=-1 face=verdana>
	
<font face=verdana><font size=+1 color=#555555><b>TUNING</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>A little tuning can go a long way, and can make the difference between
a web site that gets by, and a site that screams with speed.  With
Apache::ASP, you can easily take a poorly tuned site running at
5 hits/second to 25+ hits/second just with the right configuration.
<font face="lucida console,courier new" size=3><pre>
</pre></font>Documented below are some simple things you can do to make the 
most of your site.
<font face="lucida console,courier new" size=3><pre>
</pre></font>For more tips &amp; tricks on tuning Apache and <a href=http://perl.apache.org>mod_perl</a>, please see the tuning
documents at:
<font face="lucida console,courier new" size=3><pre>
	Stas Bekman's <a href=http://perl.apache.org>mod_perl</a> guide
	<a href=http://perl.apache.org/guide/>http://perl.apache.org/guide/</a>

	Vivek Khera's <a href=http://perl.apache.org>mod_perl</a> performance tuning
	<a href=http://perl.apache.org/tuning/>http://perl.apache.org/tuning/</a> </pre></font>

	<hr size=1>
	<table width=100% border=0 cellpadding=3 cellspacing=0>
	<tr>
	<td valign=top><font face="lucida console" size=-1>
	<ul>
	
		<tr>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#%24Application%20%26%20%24Session%20State><font color=#003090>$Application & $Session State</font></a>
			</font>
			</td>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#No%20.htaccess%20or%20StatINC><font color=#003090>No .htaccess or StatINC</font></a>
			</font>
			</td>
							
		</tr>
		
		<tr>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#High%20MaxRequests><font color=#003090>High MaxRequests</font></a>
			</font>
			</td>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#Turn%20off%20Debugging><font color=#003090>Turn off Debugging</font></a>
			</font>
			</td>
							
		</tr>
		
		<tr>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#Precompile%20Scripts><font color=#003090>Precompile Scripts</font></a>
			</font>
			</td>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#RAM%20Sparing><font color=#003090>RAM Sparing</font></a>
			</font>
			</td>
							
		</tr>
			
	</table>
	<hr size=1>
	<p>

	<p>
	<a name=%24Application%20%26%20%24Session%20State></a>
	<font face=verdana><font size=+0 color=#555555><b>$Application & $Session State</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>Use NoState 1 setting if you don't need the $Application or $Session objects.
State objects such as these tie to files on disk and will incur a performance
penalty.
<font face="lucida console,courier new" size=3><pre>
</pre></font>If you need the state objects $Application and $Session, and if 
running an OS that caches files in memory, set your &quot;StateDir&quot; 
directory to a cached file system.  On WinNT, all files 
may be cached, and you have no control of this.  On Solaris, /tmp is cached
and would be a good place to set the &quot;StateDir&quot; config setting to.  
When cached file systems are used there is little performance penalty 
for using state files.</font>
	
	<p>
	<a name=High%20MaxRequests></a>
	<font face=verdana><font size=+0 color=#555555><b>High MaxRequests</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>Set your max requests per child thread or process (in httpd.conf) high, 
so that ASP scripts have a better chance being cached, which happens after 
they are first compiled.  You will also avoid the process fork penalty on 
UNIX systems.  Somewhere between 100 - 1000 is probably pretty good.</font>
	
	<p>
	<a name=Precompile%20Scripts></a>
	<font face=verdana><font size=+0 color=#555555><b>Precompile Scripts</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>Precompile your scripts by using the Apache::ASP-&gt;Loader() routine
documented below.  This will at least save the first user hitting 
a script from suffering compile time lag.  On UNIX, precompiling scripts
upon server startup allows this code to be shared with forked child
www servers, so you reduce overall memory usage, and use less CPU 
compiling scripts for each separate www server process.  These 
savings could be significant.  On my PII300, it takes a couple seconds
to compile 28 scripts upon server startup, with an average of 50K RAM
per compiled script, and this savings is passed on to the child httpd 
servers.
<font face="lucida console,courier new" size=3><pre>
</pre></font>Apache::ASP-&gt;Loader() can be called to precompile scripts and
even entire ASP applications at server startup.  Note 
also that in modperl, you can precompile modules with the 
PerlModule config directive, which is highly recommended.
<font face="lucida console,courier new" size=3><pre>
 Apache::ASP-&gt;Loader($path, $pattern, %config)
</pre></font>This routine takes a file or directory as its first arg.  If
a file, that file will be compiled.  If a directory, that directory
will be recursed, and all files in it whose file name matches $pattern
will be compiled.  $pattern defaults to .*, which says that all scripts
in a directory will be compiled by default.  
<font face="lucida console,courier new" size=3><pre>
</pre></font>The %config args, are the config options that you want set that affect 
compilation.  These options include Debug, Global, GlobalPackage, 
DynamicIncludes, StatINC, and StatINCMatch.  If your scripts are later 
run with different config options, your scripts may have to be recompiled.
<font face="lucida console,courier new" size=3><pre>
</pre></font>Here is an example of use in a *.conf file:
<font face="lucida console,courier new" size=3><pre>
 &lt;Perl&gt;
 Apache::ASP-&gt;Loader(
	'c:/proj/site', &quot;(asp|htm)\$&quot;,
	Global =&gt; '/proj/perllib',
	Debug =&gt; 1, # see output when starting apache

	# OPTIONAL configs if you use them in your apache configuration
	# these settings affect how the scripts are compiled and loaded
	GlobalPackage =&gt; SomePackageName,
	DynamicIncludes =&gt; 1,
	StatINC =&gt; 1,
	);
 &lt;/Perl&gt;
</pre></font>This config section tells the server to compile all scripts
in c:/proj/site that end in asp or htm, and print debugging
output so you can see it work.  It also sets the Global directory
to be /proj/perllib, which needs to be the same as your real config
since scripts are cached uniquely by their Global directory.  You will 
probably want to use this on a production server, unless you cannot 
afford the extra startup time.
<font face="lucida console,courier new" size=3><pre>
</pre></font>To see precompiling in action, set Debug to 1 for the Loader() and
for your application in general and watch your error_log for 
messages indicating scripts being cached.</font>
	
	<p>
	<a name=No%20.htaccess%20or%20StatINC></a>
	<font face=verdana><font size=+0 color=#555555><b>No .htaccess or StatINC</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>Don't use .htaccess files or the StatINC setting in a production system
as there are many more files touched per request using these features.  I've
seen performance slow down by half because of using these.  For eliminating
the .htaccess file, move settings into *.conf Apache files.
<font face="lucida console,courier new" size=3><pre>
</pre></font>Instead of StatINC, try using the StatINCMatch config, which 
will check a small subset of perl libraries for changes.  This
config is fine for a production environment, and if used well
might only incur a 10-20% performance penalty.</font>
	
	<p>
	<a name=Turn%20off%20Debugging></a>
	<font face=verdana><font size=+0 color=#555555><b>Turn off Debugging</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>Turn debugging off by setting Debug to 0.  Having the debug config option
on slows things down immensely.</font>
	
	<p>
	<a name=RAM%20Sparing></a>
	<font face=verdana><font size=+0 color=#555555><b>RAM Sparing</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>If you have a lot of scripts, and limited memory, set NoCache to 1,
so that compiled scripts are not cached in memory.  You lose about
10-15% in speed for small scripts, but save at least 10K per cached
script.  These numbers are very rough.  If you use includes, you
can instead try setting DynamicIncludes to 1, which will share compiled
code for includes between scripts.</font>
	

</font>
</td>
</tr>
<tr bgcolor=#555555>
	<td colspan=2 align=center width=80%>
	<font face=verdana color=white size=-1>
	Copyright &copy; 1998-2000, Joshua Chamas, 
	<a href=http://www.chamas.com><font color=white>Chamas Enterprises Inc.</font></a>
	</font>
	</td>
</tr>
</table>
</body>
</html>
