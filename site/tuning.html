

<html>
<head>
<title>Apache :: ASP :: TUNING [ Active Server Pages for Apache with mod_perl ]</title>



</head>
<body bgcolor=white link=#3355cc alink=#ff5599 vlink=#993399>

<table border=0 cellpadding=5 cellspacing=0 height=95% width=100%>
<tr><td colspan=2 bgcolor=#ff4488><img src=apache_asp.gif alt="Apache :: ASP"></td></tr>
<tr>

<td valign=top bgcolor=#ffcccc>
	<table border=0 cellpadding=0 cellspacing=0>
	<tr><td align=center><hr size=1></td></tr>

	
		<tr>
		<td><a href=index.html><font face=verdana size=-1 color=#3355cc>INTRO</font></a></td>
		</tr>
		
		<tr>
		<td><a href=install.html><font face=verdana size=-1 color=#3355cc>INSTALL</font></a></td>
		</tr>
		
		<tr>
		<td><a href=config.html><font face=verdana size=-1 color=#3355cc>CONFIG</font></a></td>
		</tr>
		
		<tr>
		<td><a href=syntax.html><font face=verdana size=-1 color=#3355cc>SYNTAX</font></a></td>
		</tr>
		
		<tr>
		<td><a href=events.html><font face=verdana size=-1 color=#3355cc>EVENTS</font></a></td>
		</tr>
		
		<tr>
		<td><a href=objects.html><font face=verdana size=-1 color=#3355cc>OBJECTS</font></a></td>
		</tr>
		
		<tr>
		<td><a href=ssi.html><font face=verdana size=-1 color=#3355cc>SSI</font></a></td>
		</tr>
		
		<tr>
		<td><a href=cgi.html><font face=verdana size=-1 color=#3355cc>CGI</font></a></td>
		</tr>
		
		<tr>
		<td><a href=perlscript.html><font face=verdana size=-1 color=#3355cc>PERLSCRIPT</font></a></td>
		</tr>
		
		<tr>
		<td><a href=faq.html><font face=verdana size=-1 color=#3355cc>FAQ</font></a></td>
		</tr>
		
		<tr>
		<td><a href=tuning.html><font face=verdana size=-1 color=#3355cc>TUNING</font></a></td>
		</tr>
		
		<tr>
		<td><a href=kudos.html><font face=verdana size=-1 color=#3355cc>CREDITS</font></a></td>
		</tr>
		
		<tr>
		<td><a href=support.html><font face=verdana size=-1 color=#3355cc>SUPPORT</font></a></td>
		</tr>
		
		<tr>
		<td><a href=sites.html><font face=verdana size=-1 color=#3355cc>SITES USING</font></a></td>
		</tr>
		<tr><td><hr size=1></td></tr>
		<tr>
		<td><a href=eg/index.html><font face=verdana size=-1 color=#3355cc>EXAMPLES</font></a></td>
		</tr>
		
	<tr>
		<td align=center>
		<hr size=1>
		<a href=http://perl.apache.org><img 
			src=modperl.gif border=0
			alt="Powered by ModPerl & Apache"
			></a>
		<hr size=1>
		</td>
	</tr>
	</table>
</td>

<td valign=top>
<font face=verdana><font size=+1 color=#555555><b>TUNING</b></font><p>
A little tuning can go a long way, and can make the difference between
a web site that gets by, and a site that screams with speed.  With
Apache::ASP, you can easily take a poorly tuned site running at
5 hits/second to 25+ hits/second just with the right configuration.
<font face="courier new"><pre>
</pre></font>Documented below are some simple things you can do to make the 
most of your site.
<font face="courier new"><pre>
</pre></font>For more tips &amp; tricks on tuning Apache and mod_perl, please see the tuning
documents at:
<font face="courier new"><pre>
	Vivek Khera's modperl performance tuning
	<a href=http://perl.apache.org/tuning/>http://perl.apache.org/tuning/</a>

	Stas Beckman's modperl Guide
	<a href=http://perl.apache.org/guide/>http://perl.apache.org/guide/</a></pre></font>

	<hr size=1>
	<table width=100% border=0 cellpadding=5><tr><td valign=top><font face=verdana size=-1>
	<a href=#%24Application%20%26%20%24Session%20State><font color=#3355cc>$Application & $Session State</font></a><br><a href=#High%20MaxRequests><font color=#3355cc>High MaxRequests</font></a><br><a href=#Precompile%20Scripts><font color=#3355cc>Precompile Scripts</font></a><br></font></td><td valign=top><font face=verdana size=-1><a href=#No%20.htaccess%20or%20StatINC><font color=#3355cc>No .htaccess or StatINC</font></a><br><a href=#Turn%20off%20Debugging><font color=#3355cc>Turn off Debugging</font></a><br><a href=#RAM%20Sparing><font color=#3355cc>RAM Sparing</font></a><br>	
	</font>
	</td>
	</tr>
	</table>
	<hr size=1>
	<p>

	<p>
	<a name=%24Application%20%26%20%24Session%20State></a>
	<font face=verdana><font size=+0 color=#555555><b>$Application & $Session State</b></font><p>
Use NoState 1 setting if you don't need the $Application or $Session objects.
State objects such as these tie to files on disk and will incur a performace
penalty.
<font face="courier new"><pre>
</pre></font>If you need the state objects $Application and $Session, and if 
running an OS that caches files in memory, set your &quot;StateDir&quot; 
directory to a cached file system.  On WinNT, all files 
may be cached, and you have no control of this.  On Solaris, /tmp is cached
and would be a good place to set the &quot;StateDir&quot; config setting to.  
When cached file systems are used there is little performance penalty 
for using state files.</font>
	
	<p>
	<a name=High%20MaxRequests></a>
	<font face=verdana><font size=+0 color=#555555><b>High MaxRequests</b></font><p>
Set your max requests per child thread or process (in httpd.conf) high, 
so that ASP scripts have a better chance being cached, which happens after 
they are first compiled.  You will also avoid the process fork penalty on 
UNIX systems.  Somewhere between 100 - 1000 is probably pretty good.</font>
	
	<p>
	<a name=Precompile%20Scripts></a>
	<font face=verdana><font size=+0 color=#555555><b>Precompile Scripts</b></font><p>
Precompile your scripts by using the Apache::ASP-&gt;Loader() routine
documented below.  This will at least save the first user hitting 
a script from suffering compile time lag.  On UNIX, precompiling scripts
upon server startup allows this code to be shared with forked child
www servers, so you reduce overall memory usage, and use less CPU 
compiling scripts for each separate www server process.  These 
savings could be significant.  On my PII300, it takes a couple seconds
to compile 28 scripts upon server startup, with an average of 50K RAM
per compiled script, and this savings is passed on to the child httpd 
servers.
<font face="courier new"><pre>
</pre></font>Apache::ASP-&gt;Loader() can be called to precompile scripts and
even entire ASP applications at server startup.  Note 
also that in modperl, you can precompile modules with the 
PerlModule config directive, which is highly recommended.
<font face="courier new"><pre>
 Apache::ASP-&gt;Loader($path, $pattern, %config)
</pre></font>This routine takes a file or directory as its first arg.  If
a file, that file will be compiled.  If a directory, that directory
will be recursed, and all files in it whose file name matches $pattern
will be compiled.  $pattern defaults to .*, which says that all scripts
in a directory will be compiled by default.  The %config args, are the 
config options that you want set that affect compilation.  These options 
include Global &amp; DynamicIncludes.  If your scripts are later
run with different config options, your scripts may have to 
be recompiled.
<font face="courier new"><pre>
</pre></font>Here is an example of use in a *.conf file:
<font face="courier new"><pre>
 &lt;Perl&gt;
	Apache::ASP-&gt;Loader(
		'c:/proj/site', &quot;(asp|htm)\$&quot;,
		Debug =&gt; 1,
		Global =&gt; '/proj/perllib',
		GlobalPackage =&gt; SomePackageName
		);
 &lt;/Perl&gt;
</pre></font>This config section tells the server to compile all scripts
in c:/proj/site that end in asp or htm, and print debugging
output so you can see it work.  It also sets the Global directory
to be /proj/perllib, which needs to be the same as your real config
since scripts are cached uniquely by their Global directory.  You will 
probably want to use this on a production server, unless you cannot 
afford the extra startup time.
<font face="courier new"><pre>
</pre></font>To see precompiling in action, set Debug to 1 for the Loader() and
for your application in general and watch your error_log for 
messages indicating scripts being cached.</font>
	
	<p>
	<a name=No%20.htaccess%20or%20StatINC></a>
	<font face=verdana><font size=+0 color=#555555><b>No .htaccess or StatINC</b></font><p>
Don't use .htaccess files or the StatINC setting in a production system
as there are many more files touched per request using these features.  I've
seen performance slow down by half because of using these.  For eliminating
the .htaccess file, move settings into *.conf Apache files.
<font face="courier new"><pre>
</pre></font>Instead of StatINC, try using the StatINCMatch config, which 
will check a small subset of perl libraries for changes.  This
config is fine for a production environment, and if used well
might only incur a 10-20% performance penalty.</font>
	
	<p>
	<a name=Turn%20off%20Debugging></a>
	<font face=verdana><font size=+0 color=#555555><b>Turn off Debugging</b></font><p>
Turn debugging off by setting Debug to 0.  Having the debug config option
on slows things down immensely.</font>
	
	<p>
	<a name=RAM%20Sparing></a>
	<font face=verdana><font size=+0 color=#555555><b>RAM Sparing</b></font><p>
If you have a lot of scripts, and limited memory, set NoCache to 1,
so that compiled scripts are not cached in memory.  You lose about
10-15% in speed for small scripts, but save at least 10K per cached
script.  These numbers are very rough.  If you use includes, you
can instead try setting DynamicIncludes to 1, which will share compiled
code for includes between scripts.</font>
	

</td>
</tr>
<tr bgcolor=#555555>
	<td colspan=2 align=center width=80%>
	<font face=verdana color=white size=-1>Copyright (c) 1998-1999, Joshua Chamas, Chamas Enterprises Inc. </font>
	</td>
</tr>
</table>
</body>
</html>