

<html>
<head>
<title>Apache :: ASP :: EVENTS</title>



</head>
<body bgcolor=#bb4488 link=#003090 alink=#ff5599 vlink=#993399 
 marginheight=0 marginwidth=0 leftMargin=0 topMargin=0>





<table border=0 cellpadding=0 cellspacing=0 width=100%>
<tr bgcolor=#ff4488>
<td colspan=2>
	<table border=0 cellpadding=5 cellspacing=0 width=100%>
	<tr>
	<td><img border=0 src=apache_asp.gif alt="Apache :: ASP"></td>	
	
		<td align=right></td>
	
	</tr>
	</table>
</td>
</tr>
</table>

<table border=0 cellpadding=8 cellspacing=0 height=90% width=100%>
<tr>
<td valign=top width=100 bgcolor=#c0c0c0>
	<table border=0 cellpadding=0 cellspacing=0 width=100>

	
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=index.html style=text-decoration:none><font color=#003090>INTRO</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=install.html style=text-decoration:none><font color=#003090>INSTALL</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=config.html style=text-decoration:none><font color=#003090>CONFIG</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=syntax.html style=text-decoration:none><font color=#003090>SYNTAX</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>%</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><font color=#993399>EVENTS</font></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=objects.html style=text-decoration:none><font color=#003090>OBJECTS</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=ssi.html style=text-decoration:none><font color=#003090>SSI</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=sessions.html style=text-decoration:none><font color=#003090>SESSIONS</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=xml.html style=text-decoration:none><font color=#003090>XML/XSLT</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=cgi.html style=text-decoration:none><font color=#003090>CGI</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=perlscript.html style=text-decoration:none><font color=#003090>PERLSCRIPT</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=faq.html style=text-decoration:none><font color=#003090>FAQ</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=tuning.html style=text-decoration:none><font color=#003090>TUNING</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=kudos.html style=text-decoration:none><font color=#003090>CREDITS</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=support.html style=text-decoration:none><font color=#003090>SUPPORT</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=sites.html style=text-decoration:none><font color=#003090>SITES USING</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=resources.html style=text-decoration:none><font color=#003090>RESOURCES</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=todo.html style=text-decoration:none><font color=#003090>TODO</font></a></nobr></b></font></td>		

		</tr>
		
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=changes.html style=text-decoration:none><font color=#003090>CHANGES</font></a></nobr></b></font></td>		

		</tr>
		<tr><td colspan=2><hr size=1></td></tr>
		<tr>

		<td><font size=-2 face="verdana" color=#993399><b><nobr>&nbsp;</nobr></b></font></td>

		<td bgcolor=#c0c0c0><font face="verdana,arial" size=-1><b><nobr><a href=eg/index.html style=text-decoration:none><font color=#003090>EXAMPLES</font></a></nobr></b></font></td>		

		</tr>
		
	<tr>
		<td align=center colspan=2>
		<hr size=1>
		<center>
		<a href=http://www.nodeworks.com/asp/><img 
			src=powered_by_apache_asp.jpg border=0
			alt="Powered by Apache::ASP"
			></a>
		<br>
		<a href=http://perl.apache.org><img 
			src=powered_by_modperl.gif border=0
			alt="Powered by ModPerl and Apache"
			></a>
		<br>
		<a href=http://www.nodeworks.com/partner.htm?partner_id=apacheasp><img 
			src=nodecheck_button.gif border=0
			alt="Links Checked by NodeWorks"
			></a>
		</center>
		<hr size=1>
		</td>
	</tr>
	</table>
</td>



<td valign=top bgcolor=white>
<font size=-1 face=verdana>

<font face=verdana><font size=+1 color=#555555><b>EVENTS</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>The ASP platform allows developers to create Web Applications.
In fulfillment of real software requirements, ASP allows 
event-triggered actions to be taken, which are defined in
a global.asa file.  The global.asa file resides in the 
Global directory, defined as a config option , and may
define the following actions:
<font face="lucida console,courier new" size=3><pre>
	Action			Event
	------			------
        Script_OnStart *	Beginning of Script execution
        Script_OnEnd *		End of Script execution
        Script_OnFlush *	Before $Response being flushed to client.
	Application_OnStart	Beginning of Application
	Application_OnEnd	End of Application
	Session_OnStart		Beginning of user Session.
	Session_OnEnd		End of user Session.

  * These are API extensions that are not portable, but were
    added because they are incredibly useful
</pre></font>These actions must be defined in the $Global/global.asa file
as subroutines, for example:
<font face="lucida console,courier new" size=3><pre>
  sub Session_OnStart {
      $Application-&gt;{$Session-&gt;SessionID()} = started;
  }
</pre></font>Sessions are easy to understand.  When visiting a page in a
web application, each user has one unique $Session.  This 
session expires, after which the user will have a new
$Session upon revisiting.
<font face="lucida console,courier new" size=3><pre>
</pre></font>A web application starts when the user visits a page in that
application, and has a new $Session created.  Right before
the first $Session is created, the $Application is created.
When the last user $Session expires, that $Application 
expires also.</font>

	<hr size=1>
	<table width=100% border=0 cellpadding=1 cellspacing=3>
	<tr>
	<td valign=top><font face="lucida console" size=-1>
	<ul>
	
		<tr>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#Script_OnStart%20%26%20Script_OnEnd><font color=#003090>Script_OnStart & Script_OnEnd</font></a>
			</font>
			</td>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#Script_OnFlush><font color=#003090>Script_OnFlush</font></a>
			</font>
			</td>
							
		</tr>
		
		<tr>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#Session_OnStart><font color=#003090>Session_OnStart</font></a>
			</font>
			</td>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#Application_OnStart><font color=#003090>Application_OnStart</font></a>
			</font>
			</td>
							
		</tr>
		
		<tr>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#Session_OnEnd><font color=#003090>Session_OnEnd</font></a>
			</font>
			</td>
		
			<td valign=top >
			<font face="lucida console" size=-1>
			<a href=#Application_OnEnd><font color=#003090>Application_OnEnd</font></a>
			</font>
			</td>
							
		</tr>
			
	</table>
	<hr size=1>
	<p>

	<p>
	<a name=Script_OnStart%20%26%20Script_OnEnd></a>
	<font face=verdana><font size=+0 color=#555555><b>Script_OnStart & Script_OnEnd</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>The script events are used to run any code for all scripts
in an application defined by a global.asa.  Often, you would
like to run the same code for every script, which you would
otherwise have to add by hand, or add with a file include,
but with these events, just add your code to the global.asa,
and it will be run.  
<font face="lucida console,courier new" size=3><pre>
</pre></font>There is one caveat.  Code in Script_OnEnd is not guaranteed 
to be run when the user hits a STOP button, since the program
execution ends immediately at this event.  To always run critical
code, use the API extension:
<font face="lucida console,courier new" size=3><pre>
	$Server-&gt;RegisterCleanup() </pre></font>
	
	<p>
	<a name=Session_OnStart></a>
	<font face=verdana><font size=+0 color=#555555><b>Session_OnStart</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>Triggered by the beginning of a user's session, Session_OnStart
gets run before the user's executing script, and if the same
session recently timed out, after the session's triggered Session_OnEnd.
<font face="lucida console,courier new" size=3><pre>
</pre></font>The Session_OnStart is particularly useful for caching database data,
and avoids having the caching handled by clumsy code inserted into
each script being executed.</font>
	
	<p>
	<a name=Session_OnEnd></a>
	<font face=verdana><font size=+0 color=#555555><b>Session_OnEnd</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>Triggered by a user session ending, Session_OnEnd can be useful
for cleaning up and analyzing user data accumulated during a session.
<font face="lucida console,courier new" size=3><pre>
</pre></font>Sessions end when the session timeout expires, and the StateManager
performs session cleanup.  The timing of the Session_OnEnd does not
occur immediately after the session times out, but when the first 
script runs after the session expires, and the StateManager allows
for that session to be cleaned up.  
<font face="lucida console,courier new" size=3><pre>
</pre></font>So on a busy site with default SessionTimeout (20 minutes) and 
StateManager (10 times) settings, the Session_OnEnd for a particular 
session should be run near 22 minutes past the last activity that Session saw.
A site infrequently visited will only have the Session_OnEnd run
when a subsequent visit occurs, and theoretically the last session
of an application ever run will never have its Session_OnEnd run.
<font face="lucida console,courier new" size=3><pre>
</pre></font>Thus I would not put anything mission-critical in the Session_OnEnd,
just stuff that would be nice to run whenever it gets run.</font>
	
	<p>
	<a name=Script_OnFlush></a>
	<font face=verdana><font size=+0 color=#555555><b>Script_OnFlush</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>API extension. This event will be called prior to flushing
the $Response buffer to the web client.  At this time,
the $Response->{BinaryRef} buffer reference may be used to modify 
the buffered output at runtime to apply global changes to scripts 
output without having to modify all the scripts.
<font face="lucida console,courier new" size=3><pre>
 sub Script_OnFlush {
   my $ref = $Response-&gt;{BinaryRef};
   $$ref =~ s/\s+/ /sg; # to strip extra white space
 }
</pre></font>Check out the <a href=eg/global.asa>./site/eg/global.asa</a> for an example of its use.</font>
	
	<p>
	<a name=Application_OnStart></a>
	<font face=verdana><font size=+0 color=#555555><b>Application_OnStart</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>This event marks the beginning of an ASP application, and 
is run just before the Session_OnStart of the first Session
of an application.  This event is useful to load up
$Application with data that will be used in all user sessions.</font>
	
	<p>
	<a name=Application_OnEnd></a>
	<font face=verdana><font size=+0 color=#555555><b>Application_OnEnd</b></font><p>
<font face="lucida console,courier new" size=3><pre>
</pre></font>The end of the application is marked by this event, which
is run after the last user session has timed out for a 
given ASP application.</font>
	

</font>
</td>
</tr>
<tr bgcolor=#555555>
	<td colspan=2 align=center width=80%>
	<font face=verdana color=white size=-1>
	Copyright &copy; 1998-2000, Joshua Chamas, 
	<a href=http://www.chamas.com><font color=white>Chamas Enterprises Inc.</font></a>
	</font>
	</td>
</tr>
</table>
</body>
</html>
